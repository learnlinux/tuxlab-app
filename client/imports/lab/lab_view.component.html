<!-- Lab Component -->
<div class="tuxlab-lab-view" fxLayout fxLayoutAlign="center flex-start" *ngIf="(session | async); else loading">

  <!-- Markdown Component -->
  <div>

    <!-- Toolbar -->
    <md-toolbar>
      <button md-icon-button (click)="task_index = (task_index > 0) ? task_index - 1 : task_index"><md-icon>arrow_back</md-icon></button>

      <span class="center-text">
        <span class="number">{{ task_index + 1 }}</span>
        {{ (lab | async)?.tasks[task_index]?.name }}
      </span>

      <span>
        <button *ngIf="task_index < (session | async)?.current_task" md-icon-button (click)="task_index = task_index + 1" ><md-icon>arrow_forward</md-icon></button>
        <button *ngIf="task_index >= (session | async)?.current_task" md-icon-button (click)="check"><md-icon>check</md-icon></button>
      </span>

    </md-toolbar>

    <!-- Content -->
    <div class="task_content" *ngIf="(session | async)?.tasks[task_index] && (lab | async)?.tasks[task_index]">
      <!-- Task Instructions -->
      <markdown [data]="(lab | async)?.tasks[task_index]?.md"></markdown>

      <!-- Feedback -->
      <markdown [data]="(session | async)?.tasks[task_index]?.feedback"></markdown>
    </div>

  </div>

  <!-- Terminal Component -->
  <div>
    <md-toolbar>

      <md-select placeholder="Machine" *ngIf="(session | async)?.containers?.length > 1" [(ngModel)]="container_index">
         <md-option *ngFor="let container of (session | async)?.containers; let i = index" [value]="i">{{ (container)?.name ? container.name : i + 1 }}</md-option>
      </md-select>
      <span *ngIf="(session | async)?.containers?.length == 1">
        {{ (session | async)?.containers[0]?.name ? (session | async)?.containers[0].name : LabVM }}
      </span>

      <span class="spacer"></span>

      <button md-icon-button (click)="connectionDetails()"><md-icon>dns</md-icon></button>
      <button md-icon-button (click)="refresh()"><md-icon>refresh</md-icon></button>
    </md-toolbar>

    <tuxlab-terminal [container]="containers[container_index]"></tuxlab-terminal>
  </div>
</div>

<!-- Loading Spinner -->
<ng-template #loading>
  <div class="loading" fxLayout="column" fxLayoutAlign="center center">
    <div><h2> {{ (lab | async)?.name }} </h2></div>
    <md-progress-spinner color="primary" mode="indeterminate"></md-progress-spinner>
  </div>
</ng-template>
